"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=_superPropBase(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},_get.apply(this,arguments)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=_getPrototypeOf(e);if(t){var a=_getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}!function(e,t){var n=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"dateDiffInDays",value:function(e,t){return e&&t?parseInt((e>t?e-t:t-e)/864e5):0}},{key:"dateDiffInSeconds",value:function(e,t){return e&&t?parseInt((e>t?e-t:t-e)/1e3):0}},{key:"dateDiffInMinutes",value:function(e,t){return e&&t?parseInt((e>t?e-t:t-e)/6e4):0}},{key:"dateDiffInHours",value:function(e,t){return e&&t?parseInt((e>t?e-t:t-e)/36e5):0}},{key:"dateDiffInWeeks",value:function(e,t){return e&&t?parseInt((e>t?e-t:t-e)/6048e5):0}},{key:"dateDiffInMonths",value:function(e,t){if(!e||!t)return 0;var n=new Date(e).getFullYear(),r=new Date(t).getFullYear(),a=new Date(e).getMonth(),o=new Date(t).getMonth();return e>t?a+12*n-(o+12*r):o+12*r-(a+12*n)}},{key:"dateDiffInYears",value:function(e,t){return e&&t?parseInt((e>t?e-t:t-e)/31536e6):0}}]),e}(),r=function(n){_inherits(a,window.elementorModules.frontend.handlers.Base);var r=_createSuper(a);function a(){return _classCallCheck(this,a),r.apply(this,arguments)}return _createClass(a,[{key:"getDefaultSettings",value:function(){return{selectors:{fields:".flexy-calculated-field",input:".flexy-calculated-field__input",value:".flexy-calculated-field__value"},availableTools:["dateDiffInDays","dateDiffInSeconds","dateDiffInMinutes","dateDiffInHours","dateDiffInWeeks","dateDiffInMonths","dateDiffInYears"]}}},{key:"getDefaultElements",value:function(){var e=this.getSettings("selectors");return{$fields:this.$element.find(e.fields)}}},{key:"bindEvents",value:function(){var t=this;this.elements.$fields.each((function(){var n=e(this);((n.data("settings")||{}).listen_fields||[]).forEach((function(e){n.closest("form").find("[id ^="+e+"]").on("input",(function(){t.calculatedField(n)}))}))}))}},{key:"onInit",value:function(){_get(_getPrototypeOf(a.prototype),"onInit",this).call(this);var t=this;this.elements.$fields.each((function(){t.calculatedField(e(this))}))}},{key:"calculatedField",value:function(e){var t=this,n=this.getSettings("selectors"),r=e.data("settings")||{},a=r.animate||!1,o=r.decimal_points||0,i=r.add_thousands_sep||!1,l=e.find(n.input).data("raw-value")||0,u=this.calculateValue(e)||0,s=this.numberFormat(u,r);if(e.find(n.input).val(s).data("raw-value",u).trigger("input"),a){var c={duration:r.animation_duration||2e3,rounding:o,toValue:u};if(o&&parseInt(o,10)>0)"."!==(r.decimal_sep||".")&&(c.onStep=function(a){e.find(n.value).text(t.numberFormat(a,r))});i&&(c.delimiter=r.thousands_sep||",",c.fromValue=l),e.find(n.value).numerator(c)}else e.find(n.value).text(s)}},{key:"numberFormat",value:function(e,t){var n=t.decimal_points||0,r=t.add_thousands_sep||!1;if(e=parseFloat(e).toFixed(n),n&&parseInt(n,10)>0){var a=t.decimal_sep||".";"."!==a&&(e=e.replace(".",a))}if(r){var o=t.thousands_sep||",";if(e=e.toString(),n&&parseInt(n,10)>0){var i=e.substring(e.length-(n+1),e.length),l=e.substring(0,e.length-(n+1));return this.addThousandsSeparator(l,o)+i}return this.addThousandsSeparator(e,o)}return e}},{key:"addThousandsSeparator",value:function(e,t){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,t)}},{key:"removeThousandsSeparator",value:function(e){return e.toString().replace(/,(?=\d{3})/g,"")}},{key:"calculateValue",value:function(e){var n=this,r=e.data("settings")||{},a=String(r.formula)||null,o=null;if(!a)return null;a=(a=t.hooks.applyFilters("forms/calculated-field/formula/before-parse",a,e)).replace(/\[([a-zA-Z0-9-_]+)\]/g,(function(t,r){return n.getFieldValue(e.closest("form").find("[id ^="+r+"]"))}));var i=n.getSettings("availableTools")||[],l=new RegExp("("+i.join("|")+")","g");a=a.replace(l,(function(e,t){return"window.CalculatedFieldTools."+t})),a=t.hooks.applyFilters("forms/calculated-field/formula/after-parse",a,e);try{o=new Function("return "+a)}catch(t){var u="The calculation formula contains syntax errors. Please, check the formula.";return this.isEdit?e.append('<div style="width:100%;color:red">'+u+"</div>"):console.error(u+" (Form Name: "+e.closest("form").attr("name")+")"),0}return o()}},{key:"getFieldValue",value:function(e){var n=0;if(e.length)switch(e[0].nodeName){case"INPUT":if(e.length>1){for(var r=0;r<e.length;r++)if(e[r].checked){var a=0;a=void 0!==e[r].dataset.calculate?e[r].dataset.calculate?e[r].dataset.calculate:0:e[r].value,"checkbox"===e[r].type?n+=parseFloat(a):n=a}}else"checkbox"===e[0].type?e[0].checked&&(n=void 0!==e[0].dataset.calculate?e[0].dataset.calculate?e[0].dataset.calculate:0:e[0].value):n=e[0].classList.contains("elementor-date-field")?Date.parse(e[0].value):e[0].classList.contains("flexy-calculated-field__input")?e.data("raw-value"):e[0].value;break;case"SELECT":for(var o=e.find("option:selected"),i=0;i<o.length;i++){var l=0;l=void 0!==o[i].dataset.calculate?o[i].dataset.calculate?o[i].dataset.calculate:0:o[i].value,n+=parseFloat(l)}}return n||(n="0"),n=t.hooks.applyFilters("forms/calculated-field/value",n,e)}}]),a}();window.CalculatedFieldTools=new n,e(window).on("elementor/frontend/init",(function(){t.elementsHandler.attachHandler("form",r)}))}(jQuery,window.elementorFrontend)